import Resolver from"../resolver.js";import default_resolver from"./default.js";import{create_object}from"../common.js";import{SearchResults,EnrichedSearchResults,IntermediateSearchResults}from"../type.js";import{apply_enrich}from"../document/search.js";Resolver.prototype.xor=function(){const{final:a,promises:b,limit:c,offset:d,enrich:e,resolve:f,suggest:g}=this.handler("xor",arguments);return return_result.call(this,a,b,c,d,e,f,g)};function return_result(a,b,c,d,e,f,g){if(b.length){const h=this;return Promise.all(b).then(function(b){a=[];for(let c,d=0;d<b.length;d++)(c=b[d]).length&&(a[d]=c);return return_result.call(h,a,[],c,d,e,f,g)})}if(!a.length)g||(this.result=a);else if(this.result.length&&a.unshift(this.result),2>a.length)this.result=a[0];else return this.result=exclusive.call(this,a,c,d,f,this.boostval),f?e?apply_enrich.call(this.index,this.result):this.result:this;return f?this.resolve(c,d,e):this}function exclusive(a,b,c,d,e){const f=[],g=create_object();let h=0;for(let f,j=0;j<a.length;j++)if(f=a[j],f){h<f.length&&(h=f.length);for(let a,b=0;b<f.length;b++)if(a=f[b],a)for(let b,c=0;c<a.length;c++)b=a[c],g[b]=g[b]?2:1}for(let l,m=0,j=0;m<h;m++)for(let h,k=0;k<a.length;k++)if(h=a[k],h&&(l=h[m],l))for(let a,h=0;h<l.length;h++)if(a=l[h],1===g[a]){if(c){c--;continue}if(!d){const c=m+(k?e:0);if(f[c]||(f[c]=[]),f[c].push(a),++j===b)return f}else if(f.push(a),f.length===b)return f}return f}